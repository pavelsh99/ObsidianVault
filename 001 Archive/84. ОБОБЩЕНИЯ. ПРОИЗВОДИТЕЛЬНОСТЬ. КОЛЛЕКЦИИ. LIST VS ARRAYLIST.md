---
tags:
  - csharp
  - обобщения
date: 2026-02-21
---
[Обобщения в C# | производительность | коллекции | list vs arraylist | C# ООП | # 84](https://www.youtube.com/watch?v=aToq1UEKSuM&list=PLQOaTSbfxUtD6kMmAYc8Fooqya3pjLs1N&index=105)
# Сравним 2 версии метода `Swap`

```csharp
    public static class SwapTestClass
    {
        public static void GenericSwap<T>(T FirstValue, T SecondValue)
        {
            T temp = FirstValue;
            FirstValue = SecondValue;
            SecondValue = temp;
        }
        public static void RefSwap(ref object  FirstValue, ref object SecondValue)
        {
            object temp = FirstValue;
            FirstValue = SecondValue;
            SecondValue = temp;
        }
    }
```

![[Pasted image 20260221122143.png]]

Обобщенный метод в разы быстрее.

# Коллекции

В C# изначально существовали только необобщённые коллекции, сейчас они практически не используются

`List` это по сути массив, в обертке со своими уже готовыми методами

`ArrayList` это необобщенная версия того же самого массива

Бенчмарк, сравнивающий эти классы:

![[Pasted image 20260221123058.png]]

Обобщенная версия сработала быстрее.

## Почему обобщенная коллекция быстрее?

Как выглядит `List` в управляемой куче:

![[Pasted image 20260221123441.png]]

Выглядит, как простой массив. То есть непрерывная область оперативной памяти, где чтобы добраться до нужного элемента, достаточно отступить от первого элемента индекс умножить на размер одного элемента массива.

+ Под капотом генерируется код, под каждый тип данных, и в нем будут реальные данные, которые легко удалить

Как выглядит `ArrayList` в управляемой куче:

![[Pasted image 20260221123415.png]]

Потому что у `ArrayList` под капотом `object`.  `object` это ссылочный тип. И внутри будут находиться ссылки, на разные участки в оперативной памяти.

+ При удалении такого массива сборщику мусору потребуется гораздо больше времени чтобы найти и удалить все эти элементы
+ При создании каждого элемента, даже если это тип `int`, будет происходить упаковка:
![[Pasted image 20260221124100.png]]


# Вывод

Необобщенные коллекции нет смысла использовать

(+ даже потому что если мы хотим лист с типом `object`, мы можем указать это при создании обобщенного листа: 

```csharp
List<object> list = new List<object>; 
```